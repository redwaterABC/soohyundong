<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>3D Crack Viewer</title>

<style>
    body { margin: 0; background: black; overflow: hidden; }

    /* ‚ñ∂ Ïä§Ï∫îÌïòÍ∏∞ Î≤ÑÌäº */
    #scanButton {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        background: #00C2FF;
        color: white;
        padding: 18px 40px;
        font-size: 22px;
        border-radius: 50px;
        border: none;
        cursor: pointer;
        display: block;
    }

    /* ‚ñ∂ Î°úÎî© */
    #loadingBarContainer {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        width: 60%;
        height: 20px;
        background: #333;
        border-radius: 20px;
        display: none;
    }
    #loadingBar {
        height: 100%;
        width: 0%;
        background: #00C2FF;
        border-radius: 20px;
    }

    /* ‚ñ∂ Ìï´Ïä§Ìåü ÏõêÌòï Î≤ÑÌäº */
    .hotspot {
        width: 22px;
        height: 22px;
        border-radius: 50%;
        border: 3px solid #00C2FF;
        background: rgba(0, 194, 255, 0.2);
        position: absolute;
        cursor: pointer;
        transform: translate(-50%, -50%);
    }

    /* ‚ñ∂ ÌåùÏóÖ */
    .popup {
        position: absolute;
        top: 10%; left: 50%;
        transform: translateX(-50%);
        width: 380px;
        background: rgba(0,0,0,0.85);
        border: 2px solid #00C2FF;
        border-radius: 10px;
        padding: 10px;
        display: none;
    }
    .popup img {
        width: 100%;
        border-radius: 8px;
    }
    .popup-text {
        color: white;
        margin-top: 10px;
        font-size: 18px;
        text-align: center;
    }
    .popup-close {
        color: #00C2FF;
        font-size: 20px;
        text-align: right;
        cursor: pointer;
    }
</style>
</head>

<body>
<button id="scanButton">Ïä§Ï∫îÌïòÍ∏∞</button>

<div id="loadingBarContainer">
    <div id="loadingBar"></div>
</div>

<div id="popup" class="popup">
    <div class="popup-close" onclick="closePopup()">‚úï</div>
    <img id="popupImg">
    <div id="popupText" class="popup-text"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.170.0/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.170.0/examples/js/controls/OrbitControls.js"></script>

<script>
let scene, camera, renderer, controls, model;

document.getElementById("scanButton").onclick = () => {
    document.getElementById("scanButton").style.display = "none";
    document.getElementById("loadingBarContainer").style.display = "block";
    load3DModel();
};

function load3DModel() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 500);
    camera.position.set(0, 1, 3);

    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    controls = new THREE.OrbitControls(camera, renderer.domElement);

    const loader = new THREE.GLTFLoader();
    loader.load(
        "modelcrack.glb",
        (glb) => {
            model = glb.scene;
            scene.add(model);
            document.getElementById("loadingBarContainer").style.display = "none";
            createHotspots();
        },
        (xhr) => {
            const percent = (xhr.loaded / xhr.total) * 100;
            document.getElementById("loadingBar").style.width = percent + "%";
        },
        () => alert("Î™®Îç∏ Î°úÎî© Ïã§Ìå®")
    );

    scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1));
    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }
    animate();
}

/* üî• Hotspot 4Í∞ú */
const hotspotData = [
    { position: [3, -3, 3], image: "a.jpg", text: "Î≤Ω Í∑†Ïó¥" },
    { position: [-0.1, 1.00, 0.2], image: "b.jpg", text: "Î≤Ω ÎàÑÏàò ÏùòÏã¨" },
    { position: [0.5, 0.95, 0.3], image: "c.jpg", text: "Î≤Ω ÌÅ¨Îûô Ïù¥ÏÉÅ" },
    { position: [-0.4, 0.85, 0.5], image: "d.jpg", text: "Ìô©ÌòÑÎèô" }
];

function createHotspots() {
    hotspotData.forEach((spot) => {
        const div = document.createElement("div");
        div.className = "hotspot";
        document.body.appendChild(div);

        div.onclick = () => openPopup(spot.image, spot.text);

        div.updatePosition = () => {
            const pos = new THREE.Vector3(...spot.position);
            pos.project(camera);
            div.style.left = ((pos.x + 1) / 2) * window.innerWidth + "px";
            div.style.top  = ((-pos.y + 1) / 2) * window.innerHeight + "px";
        };

        function update() {
            if (model) div.updatePosition();
            requestAnimationFrame(update);
        }
        update();
    });
}

/* ÌåùÏóÖ */
function openPopup(img, text) {
    document.getElementById("popupImg").src = img;
    document.getElementById("popupText").innerText = text;
    document.getElementById("popup").style.display = "block";
}
function closePopup() {
    document.getElementById("popup").style.display = "none";
}
</script>
</body>
</html>
