<!DOCTYPE html>
<html lang="kr">
<head>
<meta charset="UTF-8">
<title>3D 하자 스캔 뷰어</title>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: white;
  }
  #startScreen, #loadingScreen, #viewerScreen {
    display: none;
    flex-direction: column;
    align-items: center;
  }
  #startScreen {
    display: flex;
  }
  button {
    padding: 14px 25px;
    font-size: 18px;
    background: #00b7ff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  #loadingBarContainer {
    width: 280px;
    height: 20px;
    border: 2px solid white;
    margin-top: 20px;
  }
  #loadingBar {
    width: 0%;
    height: 100%;
    background: #00ff88;
  }
  model-viewer {
    width: 100vw;
    height: 100vh;
  }

  /* 팝업 */
  #popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.9);
    border-radius: 10px;
    padding: 20px;
    width: 300px;
    display: none;
    text-align: center;
  }
  #popup img {
    width: 100%;
    border-radius: 6px;
  }
  #popup button {
    margin-top: 12px;
    background: #ff4444;
  }
</style>

<!-- model-viewer -->
<script type="module"
  src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
</script>
</head>

<body>

<!-- 시작 화면 -->
<div id="startScreen">
  <h2>3D 스캔 분석 시작</h2>
  <button onclick="beginLoading()">스캔하기</button>
</div>

<!-- 로딩 화면 -->
<div id="loadingScreen">
  <h3>스캔 중...</h3>
  <div id="loadingBarContainer">
    <div id="loadingBar"></div>
  </div>
</div>

<!-- 3D 뷰어 -->
<div id="viewerScreen">
  <model-viewer src="model-crack.glb"
    camera-controls auto-rotate exposure="1.1" environment-image="neutral">
    
    <!-- 핫스팟 -->
    <button slot="hotspot-1" data-position="0 0.7 0.2" class="hotspot"
      onclick="showPopup('a.jpg', '벽 균열')"></button>
    <button slot="hotspot-2" data-position="-0.4 0.5 0.1" class="hotspot"
      onclick="showPopup('b.jpg', '벽 누수 의심')"></button>
    <button slot="hotspot-3" data-position="0.3 0.2 -0.2" class="hotspot"
      onclick="showPopup('c.jpg', '벽 크랙 이상')"></button>

  </model-viewer>
</div>

<!-- 팝업 -->
<div id="popup">
  <img id="popupImage">
  <p id="popupText"></p>
  <button onclick="hidePopup()">닫기</button>
</div>

<script>
function beginLoading() {
  document.getElementById("startScreen").style.display = "none";
  document.getElementById("loadingScreen").style.display = "flex";
  let bar = document.getElementById("loadingBar");
  let width = 0;
  let timer = setInterval(() => {
    width += 2;
    bar.style.width = width + "%";
    if (width >= 100) {
      clearInterval(timer);
      document.getElementById("loadingScreen").style.display = "none";
      document.getElementById("viewerScreen").style.display = "flex";
    }
  }, 40);
}

function showPopup(img, text) {
  document.getElementById("popupImage").src = img;
  document.getElementById("popupText").innerText = text;
  document.getElementById("popup").style.display = "block";
}

function hidePopup() {
  document.getElementById("popup").style.display = "none";
}
</script>

</body>
</html>
